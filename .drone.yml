---

kind: pipeline
type: docker
name: linux-amd64

platform:
  arch: amd64
  os: linux

steps:
- name: publish
  image: plugins/docker
  settings:
    registry: gitea.kanis.dev
    repo: gitea.kanis.dev/${DRONE_REPO}
    mirror: http://127.0.0.1:5000
    insecure: true
    dockerfile: docker/Dockerfile
    tags: latest
    auto_tag: "true"
    auto_tag_suffix: linux-amd64
    failure: ignore
    username:
      from_secret: gitea_username
    password:
      from_secret: gitea_password
  when:
    event:
    - push
    - tag
    - promote
---
kind: pipeline
type: docker
name: linux-arm64

platform:
  arch: arm64
  os: linux

steps:
- name: publish
  image: plugins/docker
  settings:
    registry: gitea.kanis.dev
    repo: gitea.kanis.dev/${DRONE_REPO}
    mirror: http://127.0.0.1:5000
    insecure: true
    dockerfile: docker/Dockerfile.arm64
    auto_tag: "true"
    auto_tag_suffix: linux-arm64
    failure: ignore
    username:
      from_secret: gitea_username
    password:
      from_secret: gitea_password
  when:
    event:
    - push
    - tag
    - promote
# ---
# kind: pipeline
# type: docker
# name: linux-arm

# platform:
#   arch: arm
#   os: linux

# steps:
# - name: publish
#   image: plugins/docker
#   settings:
#     registry: gitea.kanis.dev
#     repo: gitea.kanis.dev/${DRONE_REPO}
#     mirror: http://127.0.0.1:5000
#     insecure: true
#     dockerfile: docker/Dockerfile.arm
#     auto_tag: "true"
#     auto_tag_suffix: linux-arm
#     failure: ignore
#     username:
#       from_secret: gitea_username
#     password:
#       from_secret: gitea_password
#   when:
#     event:
#     - push
#     - tag
#     - promote
# ---
# kind: pipeline
# type: docker
# name: manifest

# steps:
# - name: manifest
#   image: plugins/manifest
#   settings:
#     auto_tag: "true"
#     ignore_missing: "true"
#     spec: manifest.tmpl
#     username:
#       from_secret: gitea_username
#     password:
#       from_secret: gitea_password

# trigger:
#   event:
#   - push
#   - tag

# depends_on:
# - linux-amd64
# - linux-aarch64
# - linux-arm